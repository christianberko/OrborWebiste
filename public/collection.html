<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Orobor - Tennis Strings Reborn</title>
  <meta name="description" content="Orobor transforms discarded tennis strings into sustainable fashion. Join the circular economy movement.">
  <link rel="stylesheet" href="css/index.css">
  <link rel="stylesheet" href="css/collection.css">
  <link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" >
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  
</head>
<body>
  <header>
    <div class="header-logo-title">
      <img src="imgs/OroborLogo.svg" alt="Orobor Logo" class="orobor-logo-svg orobor-logo-white" />
      <h1 class="brand">OROBOR</h1>
    </div>
    
    <!-- Desktop Navigation -->
    <nav class="desktop-nav">
      <a href="index.html">HOME</a>
      <a href="OurTeam.html">OUR TEAM</a>
      <a href="collection.html">COLLECTION LOCATIONS</a>
      <a href="partner.html">SEND STRINGS</a>
      <!-- Dashboard link - only visible to authenticated founders -->
      <a href="/dashboard" class="nav-dashboard" id="nav-dashboard" style="display: none;">DASHBOARD</a>
    </nav>
    
    <!-- Mobile Hamburger Button -->
    <button class="hamburger-btn" id="hamburger-btn" aria-label="Toggle menu">
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
    </button>
    
    <!-- Mobile Navigation Menu -->
    <nav class="mobile-nav" id="mobile-nav">
      <div class="mobile-nav-content">
        <a href="index.html">HOME</a>
        <a href="OurTeam.html">OUR TEAM</a>
        <a href="collection.html">COLLECTION LOCATIONS</a>
        <a href="#">SEND STRINGS</a>
        <!-- Dashboard link for mobile - only visible to authenticated founders -->
        <a href="/dashboard" class="mobile-dashboard" id="mobile-dashboard" style="display: none;">DASHBOARD</a>
        <div class="mobile-auth-loading" id="mobile-auth-loading" style="display: none;">
          <i class="fas fa-spinner fa-spin"></i>
        </div>
        <a href="SignIn.html" class="mobile-signin" id="mobile-signin" style="display: none;">SIGN IN</a>
        <!-- Mobile user menu - only visible to authenticated founders -->
        <div class="mobile-user-menu" id="mobile-user-menu" style="display: none;">
          <span class="mobile-user-email" id="mobile-user-email"></span>
          <button class="mobile-signout-btn" id="mobile-signout-btn">SIGN OUT</button>
        </div>
      </div>
    </nav>
    
    <!-- Desktop Sign In/User Button -->
    <div class="auth-button-container">
      <div class="auth-loading" id="auth-loading" style="display: none;">
        <i class="fas fa-spinner fa-spin"></i>
      </div>
      <button class="btn-signIn desktop-signin" id="desktop-signin" style="display: none;">
        <a href="SignIn.html">SIGN IN</a>
      </button>
      <div class="user-menu" id="user-menu" style="display: none;">
        <span class="user-email" id="user-email"></span>
        <button class="btn-signout" id="btn-signout">SIGN OUT</button>
      </div>
    </div>
  </header>

  <div class="map-header">
    <h1>String Collection Partners</h1>
  </div>

  <div class="container">
    <!-- Full-screen map -->
    <div id="map"></div>
    
    <!-- Floating search bar -->
    <div class="search-overlay">
      <input type="text" id="search-input" placeholder="Search tennis locations...">
      <div class="search-results" id="search-results"></div>
    </div>
    
    <!-- State filter dropdown -->
    <div class="state-filter-container">
      <select id="state-filter" class="state-filter">
        <option value="all">All States</option>
        <option value="Arizona">Arizona</option>
        <option value="California">California</option>
        <option value="Connecticut">Connecticut</option>
        <option value="D.C.">D.C.</option>
        <option value="Florida">Florida</option>
        <option value="Georgia">Georgia</option>
        <option value="Hawaii">Hawaii</option>
        <option value="Illinois">Illinois</option>
        <option value="Louisiana">Louisiana</option>
        <option value="Maryland">Maryland</option>
        <option value="Minnesota">Minnesota</option>
        <option value="New York">New York</option>
        <option value="North Carolina">North Carolina</option>
        <option value="South Carolina">South Carolina</option>
        <option value="Texas">Texas</option>
        <option value="Vermont">Vermont</option>
        <option value="Virginia">Virginia</option>
        <option value="Wisconsin">Wisconsin</option>
      </select>
    </div>
    
    <!-- Floating location counter -->
    <div class="location-counter" id="location-counter">
      <span class="count" id="location-count">0</span>
      <span class="label">Locations</span>
    </div>
    
    <!-- Expandable location panel -->
    <div class="location-panel" id="location-panel">
      <div class="panel-drag-handle"></div>
      <div class="location-panel-header">
        <h2>Tennis String Collection Points</h2>
        <button class="panel-close" id="panel-close">Ã—</button>
      </div>
      <div id="location-list"></div>
    </div>
    
    <!-- Backdrop for panel -->
    <div class="panel-backdrop" id="panel-backdrop"></div>
  </div>

  <div class="partner-section-cards">
    <div class="cards-header">
      <h2>Become a Collection Partner</h2>
      <p>Join the circular economy movement and make your tennis facility part of the solution.</p>
    </div>
    
    <div class="benefits-grid">
      <div class="benefit-card">
        <div class="benefit-icon">
          <i class="fas fa-leaf"></i>
        </div>
        <h3>Environmental Impact</h3>
        <p>Help reduce tennis string waste and support sustainable fashion while making a real difference for our planet.</p>
      </div>
      
      <div class="benefit-card">
        <div class="benefit-icon">
          <i class="fas fa-users"></i>
        </div>
        <h3>Community Engagement</h3>
        <p>Attract eco-conscious players and build a sustainable community around your tennis facility.</p>
      </div>
      
      <div class="benefit-card">
        <div class="benefit-icon">
          <i class="fas fa-chart-line"></i>
        </div>
        <h3>Brand Recognition</h3>
        <p>Position your facility as a leader in tennis sustainability and enhance your reputation.</p>
      </div>
    </div>
    
    <a href="partner.html" class="cta-button-cards">
      Start Partnership
      <i class="fas fa-arrow-right"></i>
    </a>
  </div>
    
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>
  <script src="js/map.js"></script>
  
  <script>
    // Mobile hamburger menu functionality and authentication
    document.addEventListener('DOMContentLoaded', function() {
      const hamburgerBtn = document.getElementById('hamburger-btn');
      const mobileNav = document.getElementById('mobile-nav');
      const mobileNavLinks = document.querySelectorAll('.mobile-nav-content a');
      
      // Navigation elements
      const navDashboard = document.getElementById('nav-dashboard');
      const mobileDashboard = document.getElementById('mobile-dashboard');
      const desktopSignin = document.getElementById('desktop-signin');
      const mobileSignin = document.getElementById('mobile-signin');
      const userMenu = document.getElementById('user-menu');
      const userEmail = document.getElementById('user-email');
      const btnSignout = document.getElementById('btn-signout');
      const mobileUserMenu = document.getElementById('mobile-user-menu');
      const mobileUserEmail = document.getElementById('mobile-user-email');
      const mobileSignoutBtn = document.getElementById('mobile-signout-btn');
      const authLoading = document.getElementById('auth-loading');
      const mobileAuthLoading = document.getElementById('mobile-auth-loading');

      // Show loading state initially
      showLoadingState();

      // Check authentication status on page load
      checkAuthStatus();

      // Sign out functionality
      btnSignout.addEventListener('click', async function() {
        try {
          const response = await fetch('/api/auth/signout', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            }
          });

          if (response.ok) {
            // Update UI to show signed out state
            updateNavigationState(false);
            // Redirect to home page
            window.location.href = '/';
          } else {
            console.error('Sign out failed');
          }
        } catch (error) {
          console.error('Sign out error:', error);
        }
      });

      // Mobile sign out functionality
      mobileSignoutBtn.addEventListener('click', async function() {
        try {
          const response = await fetch('/api/auth/signout', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            }
          });

          if (response.ok) {
            // Update UI to show signed out state
            updateNavigationState(false);
            // Close mobile menu
            hamburgerBtn.classList.remove('active');
            mobileNav.classList.remove('active');
            document.body.classList.remove('menu-open');
            // Redirect to home page
            window.location.href = '/';
          } else {
            console.error('Sign out failed');
          }
        } catch (error) {
          console.error('Sign out error:', error);
        }
      });

      async function checkAuthStatus() {
        try {
          const response = await fetch('/api/auth/status');
          const data = await response.json();
          
          if (data.authenticated && data.user) {
            // User is signed in - show dashboard and user menu
            updateNavigationState(true, data.user.email);
          } else {
            // User is not signed in - show sign in button
            updateNavigationState(false);
          }
        } catch (error) {
          console.error('Auth status check failed:', error);
          // Default to signed out state on error
          updateNavigationState(false);
        }
      }

      function showLoadingState() {
        // Hide all auth elements
        desktopSignin.style.display = 'none';
        mobileSignin.style.display = 'none';
        userMenu.style.display = 'none';
        mobileUserMenu.style.display = 'none';
        navDashboard.style.display = 'none';
        mobileDashboard.style.display = 'none';
        
        // Show loading spinners
        authLoading.style.display = 'inline-block';
        mobileAuthLoading.style.display = 'block';
      }

      function updateNavigationState(isAuthenticated, userEmail = '') {
        // Hide loading spinners
        authLoading.style.display = 'none';
        mobileAuthLoading.style.display = 'none';
        
        if (isAuthenticated) {
          // Show dashboard links
          navDashboard.style.display = 'inline-block';
          mobileDashboard.style.display = 'block';
          
          // Hide sign in buttons
          desktopSignin.style.display = 'none';
          mobileSignin.style.display = 'none';
          
          // Show user menu
          userMenu.style.display = 'flex';
          userEmail.textContent = userEmail;
          
          // Show mobile user menu
          mobileUserMenu.style.display = 'flex';
          mobileUserEmail.textContent = userEmail;
        } else {
          // Hide dashboard links
          navDashboard.style.display = 'none';
          mobileDashboard.style.display = 'none';
          
          // Show sign in buttons
          desktopSignin.style.display = 'inline-block';
          mobileSignin.style.display = 'block';
          
          // Hide user menu
          userMenu.style.display = 'none';
          mobileUserMenu.style.display = 'none';
        }
      }

      // Toggle mobile menu
      hamburgerBtn.addEventListener('click', function() {
        hamburgerBtn.classList.toggle('active');
        mobileNav.classList.toggle('active');
        
        // Prevent body scroll when menu is open
        if (mobileNav.classList.contains('active')) {
          document.body.classList.add('menu-open');
        } else {
          document.body.classList.remove('menu-open');
        }
      });

      // Close mobile menu when clicking on a link
      mobileNavLinks.forEach(link => {
        link.addEventListener('click', function() {
          hamburgerBtn.classList.remove('active');
          mobileNav.classList.remove('active');
          document.body.classList.remove('menu-open');
        });
      });

      // Close mobile menu when clicking outside
      mobileNav.addEventListener('click', function(e) {
        if (e.target === mobileNav) {
          hamburgerBtn.classList.remove('active');
          mobileNav.classList.remove('active');
          document.body.classList.remove('menu-open');
        }
      });

      // Close mobile menu on escape key
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && mobileNav.classList.contains('active')) {
          hamburgerBtn.classList.remove('active');
          mobileNav.classList.remove('active');
          document.body.classList.remove('menu-open');
        }
      });
    });
      </script>

    <script>
      // Global variables to store shipping label data
      let currentShippingLabelData = null;
      let currentTrackingNumber = null;

      // Function to display shipping label modal
      function displayShippingLabelModal(upsResponse) {
        try {
          // Extract data from UPS response
          const shipmentResults = upsResponse.ShipmentResponse.ShipmentResults;
          const packageResults = shipmentResults.PackageResults[0];
          const base64Image = packageResults.ShippingLabel.GraphicImage;
          const trackingNumber = packageResults.TrackingNumber;
          const totalCharges = shipmentResults.ShipmentCharges.TotalCharges.MonetaryValue;
          
          // Store data globally
          currentShippingLabelData = base64Image;
          currentTrackingNumber = trackingNumber;
          
          // Update modal content
          document.getElementById('trackingNumber').textContent = trackingNumber;
          document.getElementById('shippingCost').textContent = `$${totalCharges}`;
          document.getElementById('shippingLabelImage').src = `data:image/gif;base64,${base64Image}`;
          
          // Show modal
          document.getElementById('shippingLabelModal').style.display = 'flex';
          
          // Prevent body scroll
          document.body.style.overflow = 'hidden';
          
        } catch (error) {
          console.error('Error displaying shipping label modal:', error);
          alert('Error displaying shipping label. Please try again.');
        }
      }

      // Function to close shipping label modal
      function closeShippingModal() {
        document.getElementById('shippingLabelModal').style.display = 'none';
        document.body.style.overflow = 'auto';
        
        // Clear stored data
        currentShippingLabelData = null;
        currentTrackingNumber = null;
      }

      // Function to download shipping label
      function downloadShippingLabel() {
        if (!currentShippingLabelData) {
          alert('No shipping label data available.');
          return;
        }
        
        try {
          // Create download link
          const link = document.createElement('a');
          link.href = `data:image/gif;base64,${currentShippingLabelData}`;
          link.download = `shipping-label-${currentTrackingNumber}.gif`;
          
          // Trigger download
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
          
          // Show success message
          showNotification('Shipping label downloaded successfully!', 'success');
          
        } catch (error) {
          console.error('Error downloading shipping label:', error);
          alert('Error downloading shipping label. Please try again.');
        }
      }

      // Function to print shipping label
      function printShippingLabel() {
        if (!currentShippingLabelData) {
          alert('No shipping label data available.');
          return;
        }
        
        try {
          // Open print window
          const printWindow = window.open('', '_blank');
          printWindow.document.write(`
            <html>
              <head>
                <title>Print Shipping Label</title>
                <style>
                  body {
                    margin: 0;
                    padding: 20px;
                    font-family: Arial, sans-serif;
                  }
                  .print-header {
                    text-align: center;
                    margin-bottom: 20px;
                  }
                  .label-image {
                    width: 100%;
                    max-width: 600px;
                    height: auto;
                    display: block;
                    margin: 0 auto;
                    border: 1px solid #ddd;
                  }
                  .label-info {
                    text-align: center;
                    margin-top: 20px;
                    font-size: 14px;
                    color: #666;
                  }
                  @media print {
                    body { padding: 0; }
                    .print-header, .label-info { display: none; }
                  }
                </style>
              </head>
              <body>
                <div class="print-header">
                  <h2>Shipping Label</h2>
                  <p>Tracking Number: ${currentTrackingNumber}</p>
                </div>
                <img src="data:image/gif;base64,${currentShippingLabelData}" class="label-image" />
                <div class="label-info">
                  <p>Generated on: ${new Date().toLocaleString()}</p>
                </div>
                <script>
                  window.onload = function() {
                    setTimeout(function() {
                      window.print();
                      window.close();
                    }, 500);
                  }
                </script>
              </body>
            </html>
          `);
          printWindow.document.close();
          
        } catch (error) {
          console.error('Error printing shipping label:', error);
          alert('Error printing shipping label. Please try again.');
        }
      }

      // Function to show notification
      function showNotification(message, type = 'info') {
        // Create notification element
        const notification = document.createElement('div');
        notification.className = `notification notification-${type}`;
        notification.textContent = message;
        
        // Add styles
        notification.style.cssText = `
          position: fixed;
          top: 20px;
          right: 20px;
          padding: 15px 20px;
          border-radius: 6px;
          color: white;
          font-weight: 500;
          z-index: 10001;
          animation: slideInRight 0.3s ease-out;
          max-width: 300px;
        `;
        
        // Set background color based on type
        if (type === 'success') {
          notification.style.background = 'linear-gradient(135deg, #27ae60 0%, #2ecc71 100%)';
        } else if (type === 'error') {
          notification.style.background = 'linear-gradient(135deg, #e74c3c 0%, #c0392b 100%)';
        } else {
          notification.style.background = 'linear-gradient(135deg, #3498db 0%, #2980b9 100%)';
        }
        
        // Add to page
        document.body.appendChild(notification);
        
        // Remove after 3 seconds
        setTimeout(() => {
          notification.style.animation = 'slideOutRight 0.3s ease-in';
          setTimeout(() => {
            if (notification.parentNode) {
              notification.parentNode.removeChild(notification);
            }
          }, 300);
        }, 3000);
      }

      // Close modal when clicking outside
      document.addEventListener('click', function(event) {
        const modal = document.getElementById('shippingLabelModal');
        if (event.target === modal) {
          closeShippingModal();
        }
      });

      // Close modal with Escape key
      document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape') {
          const modal = document.getElementById('shippingLabelModal');
          if (modal.style.display === 'flex') {
            closeShippingModal();
          }
        }
      });

      // Add CSS animations for notifications
      const style = document.createElement('style');
      style.textContent = `
        @keyframes slideInRight {
          from {
            transform: translateX(100%);
            opacity: 0;
          }
          to {
            transform: translateX(0);
            opacity: 1;
          }
        }
        
        @keyframes slideOutRight {
          from {
            transform: translateX(0);
            opacity: 1;
          }
          to {
            transform: translateX(100%);
            opacity: 0;
          }
        }
      `;
      document.head.appendChild(style);
    </script>

    <!-- Shipping Label Modal -->
  <div id="shippingLabelModal" class="shipping-label-modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Shipping Label Created Successfully!</h3>
        <span class="close" onclick="closeShippingModal()">&times;</span>
      </div>
      <div class="modal-body">
        <div class="label-info">
          <p><strong>Tracking Number:</strong> <span id="trackingNumber"></span></p>
          <p><strong>Shipping Cost:</strong> <span id="shippingCost"></span></p>
        </div>
        <div class="label-container">
          <img id="shippingLabelImage" alt="Shipping Label" />
        </div>
        <div class="button-group">
          <button class="btn-download" onclick="downloadShippingLabel()">
            <i class="fas fa-download"></i> Download Label
          </button>
          <button class="btn-print" onclick="printShippingLabel()">
            <i class="fas fa-print"></i> Print Label
          </button>
          <button class="btn-close" onclick="closeShippingModal()">
            <i class="fas fa-times"></i> Close
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <div class="footer-container">
              <!-- Column 1: Brand -->
        <div class="footer-column">
          <div class="footer-brand">
            <div class="footer-brand-header">
              <h2 class="footer-brand-text">OROBOR</h2>
              <img src="/imgs/OroborLogo.svg" alt="Orobor Logo" class="footer-logo" />
            </div>
            <h3 class="footer-tagline">Tennis Strings Reborn</h3>
            <p class="footer-mission">Transforming discarded tennis strings into sustainable fashion through innovative recycling technology.</p>
          </div>
        <div class="footer-social">
          <a href="#" class="social-link" aria-label="Facebook">
            <i class="fab fa-facebook-f"></i>
          </a>
          <a href="#" class="social-link" aria-label="Instagram">
            <i class="fab fa-instagram"></i>
          </a>
          <a href="#" class="social-link" aria-label="LinkedIn">
            <i class="fab fa-linkedin-in"></i>
          </a>
          <a href="#" class="social-link" aria-label="Twitter">
            <i class="fab fa-twitter"></i>
          </a>
        </div>
      </div>

      <!-- Column 2: Contact -->
      <div class="footer-column">
        <h4 class="footer-heading">Contact Us</h4>
        <div class="footer-contact">
          <div class="contact-item">
            <i class="fas fa-map-marker-alt"></i>
            <span>123 Tennis Court Way<br>Boston, MA 02215</span>
          </div>
          <div class="contact-item">
            <i class="fas fa-phone"></i>
            <span>(617) 555-0123</span>
          </div>
          <div class="contact-item">
            <i class="fas fa-envelope"></i>
            <span>info@orobor.com</span>
          </div>
          <div class="contact-item">
            <i class="fas fa-recycle"></i>
            <span>Collection Hotline:<br>1-800-OROBOR</span>
          </div>
        </div>
      </div>

      <!-- Column 3: Hours & Location -->
      <div class="footer-column">
        <h4 class="footer-heading">Hours & Location</h4>
        <div class="footer-hours">
          <div class="hours-item">
            <strong>Main Office:</strong><br>
            Mon-Fri: 9AM-6PM<br>
            Sat: 10AM-4PM<br>
            Sun: Closed
          </div>
          <div class="hours-item">
            <strong>Collection Drop-off:</strong><br>
            24/7 at partner locations
          </div>
          <div class="hours-item">
            <strong>Processing Facility:</strong><br>
            Mon-Fri: 8AM-8PM<br>
            Sat-Sun: Closed
          </div>
        </div>
      </div>
    </div>

    <!-- Bottom Bar -->
    <div class="footer-bottom">
      <div class="footer-bottom-content">
        <p class="copyright">Â© 2024 Orobor. All rights reserved.</p>
      </div>
    </div>
  </footer>

  <script>
    // Global variables to store shipping label data
    let currentShippingLabelData = null;
    let currentTrackingNumber = null;

    // Function to display shipping label modal
    function displayShippingLabelModal(upsResponse) {
      try {
        // Extract data from UPS response
        const shipmentResults = upsResponse.ShipmentResponse.ShipmentResults;
        const packageResults = shipmentResults.PackageResults[0];
        const base64Image = packageResults.ShippingLabel.GraphicImage;
        const trackingNumber = packageResults.TrackingNumber;
        const totalCharges = shipmentResults.ShipmentCharges.TotalCharges.MonetaryValue;
        
        // Store data globally
        currentShippingLabelData = base64Image;
        currentTrackingNumber = trackingNumber;
        
        // Update modal content
        document.getElementById('trackingNumber').textContent = trackingNumber;
        document.getElementById('shippingCost').textContent = `$${totalCharges}`;
        document.getElementById('shippingLabelImage').src = `data:image/gif;base64,${base64Image}`;
        
        // Show modal
        document.getElementById('shippingLabelModal').style.display = 'flex';
        
        // Prevent body scroll
        document.body.style.overflow = 'hidden';
        
      } catch (error) {
        console.error('Error displaying shipping label modal:', error);
        alert('Error displaying shipping label. Please try again.');
      }
    }

    // Function to close shipping label modal
    function closeShippingModal() {
      document.getElementById('shippingLabelModal').style.display = 'none';
      document.body.style.overflow = 'auto';
      
      // Clear stored data
      currentShippingLabelData = null;
      currentTrackingNumber = null;
    }

    // Function to download shipping label
    function downloadShippingLabel() {
      if (!currentShippingLabelData) {
        alert('No shipping label data available.');
        return;
      }
      
      try {
        // Create download link
        const link = document.createElement('a');
        link.href = `data:image/gif;base64,${currentShippingLabelData}`;
        link.download = `shipping-label-${currentTrackingNumber}.gif`;
        
        // Trigger download
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        // Show success message
        showNotification('Shipping label downloaded successfully!', 'success');
        
      } catch (error) {
        console.error('Error downloading shipping label:', error);
        alert('Error downloading shipping label. Please try again.');
      }
    }

    // Function to print shipping label
    function printShippingLabel() {
      if (!currentShippingLabelData) {
        alert('No shipping label data available.');
        return;
      }
      
      try {
        // Open print window
        const printWindow = window.open('', '_blank');
        printWindow.document.write(`
          <html>
            <head>
              <title>Print Shipping Label</title>
              <style>
                body {
                  margin: 0;
                  padding: 20px;
                  font-family: Arial, sans-serif;
                }
                .print-header {
                  text-align: center;
                  margin-bottom: 20px;
                }
                .label-image {
                  width: 100%;
                  max-width: 600px;
                  height: auto;
                  display: block;
                  margin: 0 auto;
                  border: 1px solid #ddd;
                }
                .label-info {
                  text-align: center;
                  margin-top: 20px;
                  font-size: 14px;
                  color: #666;
                }
                @media print {
                  body { padding: 0; }
                  .print-header, .label-info { display: none; }
                }
              </style>
            </head>
            <body>
              <div class="print-header">
                <h2>Shipping Label</h2>
                <p>Tracking Number: ${currentTrackingNumber}</p>
              </div>
              <img src="data:image/gif;base64,${currentShippingLabelData}" class="label-image" />
              <div class="label-info">
                <p>Generated on: ${new Date().toLocaleString()}</p>
              </div>
              <script>
                window.onload = function() {
                  setTimeout(function() {
                    window.print();
                    window.close();
                  }, 500);
                }
              </script>
            </body>
          </html>
        `);
        printWindow.document.close();
        
      } catch (error) {
        console.error('Error printing shipping label:', error);
        alert('Error printing shipping label. Please try again.');
      }
    }

    // Function to show notification
    function showNotification(message, type = 'info') {
      // Create notification element
      const notification = document.createElement('div');
      notification.className = `notification notification-${type}`;
      notification.textContent = message;
      
      // Add styles
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 15px 20px;
        border-radius: 6px;
        color: white;
        font-weight: 500;
        z-index: 10001;
        animation: slideInRight 0.3s ease-out;
        max-width: 300px;
      `;
      
      // Set background color based on type
      if (type === 'success') {
        notification.style.background = 'linear-gradient(135deg, #27ae60 0%, #2ecc71 100%)';
      } else if (type === 'error') {
        notification.style.background = 'linear-gradient(135deg, #e74c3c 0%, #c0392b 100%)';
      } else {
        notification.style.background = 'linear-gradient(135deg, #3498db 0%, #2980b9 100%)';
      }
      
      // Add to page
      document.body.appendChild(notification);
      
      // Remove after 3 seconds
      setTimeout(() => {
        notification.style.animation = 'slideOutRight 0.3s ease-in';
        setTimeout(() => {
          if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
          }
        }, 300);
      }, 3000);
    }

    // Close modal when clicking outside
    document.addEventListener('click', function(event) {
      const modal = document.getElementById('shippingLabelModal');
      if (event.target === modal) {
        closeShippingModal();
      }
    });

    // Close modal with Escape key
    document.addEventListener('keydown', function(event) {
      if (event.key === 'Escape') {
        const modal = document.getElementById('shippingLabelModal');
        if (modal.style.display === 'flex') {
          closeShippingModal();
        }
      }
    });

    // Add CSS animations for notifications
    const style = document.createElement('style');
    style.textContent = `
      @keyframes slideInRight {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }
      
      @keyframes slideOutRight {
        from {
          transform: translateX(0);
          opacity: 1;
        }
        to {
          transform: translateX(100%);
          opacity: 0;
        }
      }
    `;
    document.head.appendChild(style);
  </script>
</body>
</html>